#
# Generic Makefile to assist with installing packages in a yum repo
#

#RPMNAMELINE :=  $(shell cat *spec | grep Name:) 
#RPMNAME := $(RPMNAMELINE:Name:=)
#YUM := /usr/bin/yum
#SUDO := /usr/bin/sudo
#RPM := /usr/bin/rpm

.DEFAULT_GOAL := help

prereqs:
	sudo apt update
	sudo apt install -y rtl-sdr librtlsdr0 soapysdr-module-rtlsdr libsoapysdr-dev
	sudo apt install -y mlocate cmake jack
	sudo /etc/cron.daily/mlocate
	git clone git://git.osmocom.org/rtl-sdr.git ~/rtl-sdr
	sudo cp ~/rtl-sdr/rtl-sdr.rules /etc/udev/rules.d/
	sudo rmmod dvb_usb_rtl28xxu
	sudo echo 'blacklist dvb_usb_rtl28xxu' | sudo tee --append /etc/modprobe.d/blacklist-dvb_usb_rtl28xxu.conf
	sudo cp systemd/rtlsdr.service /etc/systemd/system/
	sudo systemctl daemon-reload
	sudo systemctl enable rtlsdr
	sudo systemctl start rtlsdr

rx_tools:
	git clone https://github.com/rxseger/rx_tools ~/rx_tools
	cd ~/rx_tools
	cmake .
	make
	sudo make install


diff:
	${YUM} verify-rpm ${RPMNAME}

install:
	${SUDO} ${YUM} makecache --disablerepo=* --enablerepo=doit-ns,doit-ns-extras
	${SUDO} ${YUM} update  --disablerepo=* --enablerepo=doit-ns,doit-ns-extras ${RPMNAME}

help:
	@echo "Use the 'diff' target to display differences;"
	@echo "Use the 'install' target to install the RPM generated by this package."

